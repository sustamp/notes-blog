---
# layout: post
layout: post-custom
title: "系统架构师教程学习笔记"
---

>**万时定律**，10000小时定律。  
简单来说，要成为某个领域顶尖的专业人才，需要10000小时持续不断的练习。例如小提琴、足球、国际象棋、围棋等领域，无一例外都遵循这个定律。  
技术人员的成长需要对技术的热情和持续不断学习，思考，实践和总结。


## 前言
系统架构（System Architecture）是系统的一种整体的高层次的结构表示，是系统的骨架和根级，支撑和链接各个部分。

系统架构设计的主要目的是对需要开发的系统进行一系列的抽象，用于系统各个方面的设计与实现。设计的优劣决定了系统的健壮性和生命周期的长短。

**架构设计**是需求系统开发过程中**需求分析**阶段后的一个关键步骤。架构设计的作用主要包括以下几点：
- 解决相对**复杂的需求**分析问题。
- 解决**非功能**属性在系统占据重要位置的设计问题。
- 解决生命**周期长**、**拓展**性需求**高**的系统整体结构问题。
- 解决系统基于**组件**需要的**集成**问题。
- 解决业务**流程再造**难的问题。


## 发展历程

### 1.基础分析阶段（1968-1994）

随着软件规模的增大，**模块化开发**方法被逐步采用，为后续软件架构的发展奠定了基础。

模块化方法采用对复杂事物分而治之的经典原则。涉及的问题是模块设计的规则，即怎么将系统分解成模块。

每一模块都可独立开发与测试，最后在组装成一个完整软件。

将系统分解为模块，应该遵循以下规则：
1. **高**内聚。  
   - 只实现一种功能的模块是高内聚的，具有三种以上功能的模块则是低内聚的。也就是一个模块内部的元素最大限度的关联，
1. **低**耦合。
   - 不同模块之间的关系尽可能弱，以利于软件的升级和拓展。
2. 模块大小**适度**。
   - 颗粒度大，内部维护困难；
   - 颗粒度小，模块间耦合会增加。
3. 模块**调用链**的嵌套层次不可过多。
4. **接口简单**精炼，具有信息隐蔽能力。
5. 尽可能地**复用**已有模块。

### 2.概念体系的建立和核心技术形成阶段（1999-2000）

2000年，IEEE标准第一次定义了软件架构的形式化标准，这标志着软件架构的理论体系基本建立，具备普及应用的基础。

这一阶段的重要成功之一是：软件**组件化技术**。提升软件**重用**能力和**质量**。

组件的特性：
- 可组装型和可插拔行。
- 组价与组件之间不存在直接耦合关系。
- 组件和组价之间又并非绝对独立，可经过组装后与其他组件进行业务上的交互。

组件化开发与模块化开发区分：
- 组件化开发并不等同于模块化开发。模块化开发只是在逻辑上做了切分，代码通常并没有真正意义上的隔离。

组件化与应用集成区分：
- 组件化也不等同于应用集成，应用集成是将一些基于不同平台或不同方案的应用软件有机集成到一个无缝的、并列的、易于访问的单一系统中，以建立一个统一的综合应用。

组件化比模块化更独立，但比应用集成结合得更加紧密。

### 3.理论体系完善与发展阶段（1996年至今）

在这一阶段，各种方法论都在发展，主要集中在软件架构的如下几个方面：
- 描述与表示；
- 分析、设计和测试；
- 发现、演化和重用；
  - 软件架构发现属于逆向工程，解决如何从已存在的系统中提取软件架构的问题。
  - 软件架构演化是出于需求、技术、环境和分布的变化而导致架构变动。
- 开发方法；
  - 软件开发模型是跨越整个软件生存周期的，从开发、运行和维护所实施的全部工作和任务的结构框架。一般有三种：
    - 瀑布模型。以软件需求完全确认为前提。
    - 渐进式开发模型。如螺旋模型等，在软件开发初期只能提供基本需求为前提。
    - 变换模型。以形式化开发方法为基础。
- 架构风格；
  - 架构风格（架构模式）是针对给定场景中经常出现的问题提供的一般性可重用方案，反映的是领域中众多系统中共有的结构和语义特征，并指导如何将各个子模块和子系统有效地组成一个完整的系统。分类：
    - 数据流风格。
    - 调用/返回风格。
    - 独立组件风格。
    - 虚拟机风格
    - 仓库风格。
- 动态软件架构。

### 4.普及应用阶段（2000年至今）

软件架构是软件生命周期的重要产物，它影响软件开发的各个阶段：
- 需求阶段。
- 设计阶段。
- 实现阶段。
- 维护阶段。


## 软件架构的常用分类及建模方法

### 1.软件架构的常用分类

目前已形成的满足**不同用途**的架构模式，比较典型的有分层架构、事件驱动架构、微核架构、微服务架构和云架构等五类。此外像C/S、B/S、管道-过滤器和PAC等架构也是被广泛使用的。

#### 1.分层架构（LA）

Layered Architecture是最常见、也是事实上的标准架构。层与层之间通过接口进行通信，每一层都有清晰的角色和分工。

最常见的四层结构：
- 表示层（Presentation Layer）。
- 业务层（Business Layer）。
- 持久层（Presistence Layer）。提供数据，SQL语句在这一层。
- 数据层（Database Layer）。保存数据。
  
有的项目在业务层和持久层之间加了一个服务层（Service），提供不同业务逻辑需要的一些通用接口。

#### 2.事件驱动架构（EDA）

Event-Driven Architecture，Event是状态发生变化时软件发出的通知。事件驱动架构是通过事件进行通信的软件架构。它分成四个部分：
- 事件队列（Event Queue）：
  - 接收事件的入口。
- 分发器（Event Mediator）：
  - 将不同的事件分发到不同的业务逻辑单元。
- 事件通道（Event Channel）：
  - 分发器与处理器的联系渠道。
- 事件处理器（Event Processor）：
  - 实现业务逻辑，处理完成后会发出事件，触发下一步操作。

对于简单的项目，事件队列、分发、通道可以合为一体，整个软件就分成**事件代理**和**事件处理**器两部分。

观察者模式常被叫做发布-订阅模式，事件驱动架构是观察者模式的一种最佳实践，常应用于商品系统，物流系统，监控系统，运营数据分析系统等。

#### 3.微核架构

微核架构（Microkernel Architecture）又称为插件架构（Plug-in Architecture），是指软件的内核相对较小，主要功能和业务逻辑都通过插件实现。

内核（Core）通常只包含系统运行的最小功能。插件则是相互独立的，插件之间的通信应该减少到最低，避免出现互相依赖的问题。

#### 4.微服务架构

Microservices Architecture是SOA（Service-Oriented Architecture，服务导向架构）的升级。

每个服务都是一个**独立的部署**单元（Separately Deployed Unit）。这些单元都是**分布式**的，互相解耦，通过远程通信协议（如REST、SOAP）联系。

微服务架构分成三种实现模式：
- RESTful API模式：
  - 服务通过API提供，云服务就属于这一类。
- RESTful 应用模式：
  - 服务通过传统的网络协议或应用协议提供，背后通常是一个多功能的应用程序，常见于企业内部。
- 集中消息模式：
  - 采用消息代理（Message Broker）实现消息队列、负载均衡、统一日志和异常处理，缺点是会出现单点失败，消息代理可能要做成集群。
  


#### 5.云架构

Cloud Architecture主要解决**拓展性**和**并发**的问题。

云架构主要分成两部分：
- 处理单元。
  - 实现业务逻辑。
- 虚拟中间件。
  - 负责通信、保持会话控制、数据复制、分布式处理和部署管理。
  

### 2.软件架构的常用建模方法

1. 结构模型

2. 框架模型

3. 动态模型

4. 过程模型

4种模型并不完全独立，通常需要互相组合来形成一个可以刻画软件架构的完整模型。


## 第2章 计算机系统基础知识


### 2.1 计算机硬件

计算机组成结构源于冯·诺依曼计算机结构。

#### 处理器

计算机系统运算和控制核心部件。

位宽：4位 -> 64位。    
内核：单核 -> 多核、异构多核、众核。  
指令集：CISC, RISC。RISC为趋势，化繁为简。  

典型的处理器系统结构：

----指令部件  
---运算部件--寄存器--存储部件  
-----Cache部件--MMU部件  
--完成部件  
-----地址总线  
-----数据总线  

#### 存储器

存储器分为：
- 内存储器  
  - ROM（只读存储器）
  - RAM（随机存储器）
    - 1)片上缓存。SRAM结构，处理器直接集成的缓存。16~512KB。
    - 2)片外缓存。SRAM结构。256kb~4MB，可称L2Cache/L3Cache/PlatformCache
    - 3)主存（内存）。DRAM结构，以独立部件/芯片存在，通过总线与处理器链接。容量：数百M~数十GB。
- 外存储器  
  - Flash < 10年
  - 光盘 0 < y < n * 10年
  - 磁盘 > 10年
  - 磁带 > 30年

#### 总线

计算机**部件间**遵循某一特定协议实现**数据交换**的**形式**。

按位置划分为**内总线**，**系统总线**和**外部总线**。

内总线用于芯片内部互联。

系统总线是计算机中CPU、主存、IO接口的总线。

外部总线又称为通信总线，是计算机板和外部设备之间，或计算机系统之间互联的总线。

总线性能指标：
- 总线带宽
- 总线服务质量（QoS，Quality of Service）
- 总线时延
- 总线抖动

#### 接口

计算机**不同层**之间的**通信规则**。

例如有显示接口HDMI/DVI/VGA，音频输入输出接口TRS/RCA/XLR，网络接口 RJ45/FC，USB接口，SATA接口，打印机接口等等。


#### 外部设备

外围设备，如鼠标，键盘，显示器，摄像头或其他移动穿戴设备。


### 2.2 计算机软件

软件是指在系统上运行的**程序**、相关**文档**和**数据**的**集合**。按作用和运行环境分为**系统软件**和**应用软件**两大类。

#### 2.2.1 操作系统

操作系统是计算机系统的**资源管理者**，包含对软、硬件资源实施管理的一组程序。旨在合理**共享和利用**资源，发挥工作**效率**，提升处理**性能**。

#### 1.操作系统的组成

通常由**操作系统内核**和其他许多**附加的配套软件**组成。

操作系统**内核**指的是能提供**进程管理**、**存储管理**、**文件管理**和**设备管理**等功能的软件模块。

#### 2.操作系统的作用

- **管理**计算中运行的程序和分配各种软硬件资源。
- **提供**对用户友善的人机界面
- 为应用程序的开发和运行提供一个高效率的**平台**。
- 其他作用：辅导用户操作，监控系统性能等。

#### 3.操作系统的特征

- 并发性
  - 单核CPU的并发性是指在一段时间内，宏观上多个任务是并发执行的。
  - 多核CPU则可将多个程序分配到不同的CPU执行。
- 不确定性
  - 多个进程并发执行，但具体到何时执行，何时完成的时间并不是确定的，经常可能要等待资源或事件的发生而获得CPU的执行能力。"走走停停"。
- 共享性
  - 同时共享和互斥共享。多用户程序共用一套计算机系统的所有资源。
- 虚拟性
  - 将物理实体变为逻辑上的多个对应物，方便用户使用和操作。

#### 4.操作系统的分类

1. 批处理系统
   - 最早的操作系统之一，通常不具备交互性。通常是将设定好的一批作业交给系统操作员输入计算机后，由系统控制它们自动运行。
   - 典型产品IBM OS/360和OS/390
   
2. 分时操作系统
   - 允许多个用户同时访问计算机资源的操作系统。这话总操作系统将CPU的工作时间划分为许多很短的时间片，轮流分配给每个用户使用。
   - 典型产品：UNIX。
   
3. 实时操作系统
   - 对外来信息以足够快的速度进行处理。对交付能力要求不高，但可靠性要保证。
   - 典型产品：
     - 实时控制系统：数据采集、武器控制、飞机自动驾驶、导弹制导系统等。
     - 信息处理系统：飞机订票系统，情报检索等。

1. 网络操作系统
   - 网络操作系统使联网计算机能方便而有效地**共享网络资源**。
   - 常见的网络操作系统有Windows系列、Linux、Unix
   
2. 分布式操作系统
   - 多个分散的计算机连接而成的计算机系统。是网络操作系统的更高级形式，同时还有透明性、可靠性和高性能等特性。
   
   
3. 微型计算机操作系统
   - 常见的有Windows、MacOS、Linux。

4. 嵌入式操作系统
   - 运行在嵌入式智能设备中。主要特点是：
     - 微型化。
     - 可定制。
     - 实时性。
     - 可靠性。
     - 易移植。
   - 常见的嵌入式实时操作系统有VxWorks，Clinux，PaleOS，WindowsCE等。

  
#### 2.2.2 数据库

数据库是指长期存储在计算机内的，**有组织的**、**统一管理**的相关数据的集合。

目前最常见的是关系型数据库和非关系型数据库。

#### 2.2.3 文件系统
文件系统是指操作系统中实现文件统一管理的一组软件和相关数据的集合。

#### 2.2.4 网络协议
**不同**系统或**终端**之间要实现信息交换或资源分享，需要具备**共同能够理解的语言**，这就是网络协议。

网络协议规定了通信时的数据格式、传送时序、控制信息、应答信号等内容。

常用的网络协议有：
LAN、WAN、WIFI、移动网协议
互联网使用的是TCP/IP协议族。

#### 2.2.5 中间件
承担应用软件在不同系统上可顺利运行的中介，所以叫中间件，它作为应用软件与各种操作系统之间使用的**标准化**编程**接口和协议**。

中间件分类：
- 消息中间件。
  - 如IBMMQ，ActiveMQ，Kafka等。
- 事务处理（交易）中间件。
  - 每项事务在多台应用服务器间协调完成。如Tuxedo。
- 数据存取中间件
  - 经常用于分布式系统中，为虚拟缓冲存取、格式转换、解压等带来方便
- Web服务器中间件
  - 安全中间件
- 跨平台和架构的中间件
- 专用平台中间件
- 网络中间件
  
#### 2.2.6 软件构件
构件/组件：一个**程序集**或一组程序的集合。

构件提供接口供外部来访问，外部不能直接操作构件的内部。

构建的2个重要特性：
- 自包容
- 可重用
  
##### 1.软件构件的组装模型

搭积木式的开发，即构建组装。

通过需求**分析** -> **设计**构建组装结构，明确各构件之间的关系 ->  **建立**构件库 -> **开发**应用构件（独立开发、重用、使用第三方构件等） -> 测试与发布

优点：
- 自包容。
  - 构建之间通过接口访问，相互独立。
- 可重用。
  - 设计良好的构建容易被重用。降低开发成本。
- 颗粒度小。
  - 相对整个系统，构建颗粒度小，开发任务更加灵活，各个构建都可进行独立并行开发。
  
缺点：
- 需要**经验丰富**的架构设计师。
  - 否则结构设计不良，重用性也会降低。
- 性能上会有**让步**。
  - 考虑构建的独立性和重用性，会导致其他方面做出让步，最明显的就是性能。
- 有**学习成本**。
  - 需要程序员熟练掌握构件开发和组装。
- 软件**质量**不好控制。
  - 第三方的构件库质量会最终影响软件质量，而第三方构件库通常很难控制。（木桶原理：木桶容量是根据最短的那块木板决定的）

##### 2.商用构件的标准规范
1. CORBA
2. J2EE
3. DNA

#### 2.2.7 应用软件
应用软件是指为**特定**的应用场景而**设计的软件**。

 应用软件按开发方式和适用范围分为：
 - 通用应用软件
 - 定制应用软件

### 2.3 嵌入式系统及软件
嵌入式系统（Embedded System）是为了**特定应用**而专门构建且将信息处理过程和物理过程紧密结合为一体的**专用**计算机系统。

嵌入式软件是指可运行在嵌入式系统中的**程序代码**和帮助这些软件开发所用的**工具**或**环境**软件的总称。


#### 2.3.1 嵌入式系统的组成及特点
嵌入式系统定义为现代科学**多学科**相互融合的产品：
- **核心**：应用技术；
- **基础**：计算机技术；
- **载体**：通信技术；
- **对象**：消费类产品；
- 引入各类传感器。
- 引入Internet网络技术为连接。
  
嵌入式系统将**可配置**与**可裁剪**集成于一体，并具备相应的**安全性**。需要满足应用对**功能**、**成本**、**体积**、**可靠性**和**功耗**等方面的严格要求。

嵌入式系统是深埋于设备中，对设备的**各种传感器**进行管理和控制的系统。

##### 1.嵌入式系统的组成
1. 嵌入式处理器。
   - 比如ARM处理器
2. 相关支撑硬件。
   - 除处理器外的其他硬件，包括存储器、输入设备、输出设备、IO接口和网络总线。
3. 嵌入式操作系统。
   - 与通用操作系统不同，它具备实时性、可裁剪性和安全性等特征。
4. 支撑软件。
5. 应用软件。
   
###### 总结
1. 硬件：
   - 嵌入式处理器
   - 支撑硬件
2. 软件：
   - 嵌入式操作系统
   - 支撑软件
   - 应用软件
   
##### 2.嵌入式系统的特点
1. **专用**性强。
2. 技术**融合**。
   - 现金的计算机技术、通信技术、半导体技术、电子技术等各行业的具体应用相结合。
3. 软硬**一体**，软件为主。
4. 比通用计算机资源少。
5. 程序代码**固化**在**非易失**存储器中。
   - 软件一般固化在存储器芯片或单片机本身中，而不是存在磁盘中。这是为了提高执行速度和系统可靠性。
   - 非易失存储器如Flash，掉电后不会丢失数据。
6. 开发和运行是在**不同**的**环境**中进行的。（**最大特点**）
   - 需要**专门**的开发**工具**和**环境**。
   - 运行环境为目标机，开发环境为宿主机。
7. 对**安全性**和**可靠性**要求高。
8. 体积小、价格低、工艺先进、性价比高、系统配置要求低、实时性强。

#### 2.3.2嵌入式系统的分类
从不同用途分为：
- 嵌入式**实时**系统。
  - 强实时系统。（Hard Real-Time）
  - 若实时系统。（Weak Real-Time）
- 嵌入式**非实时**系统。
  
从安全角度分为：
- **安全**攸关系统。（Safety-Critical / Life-Critical）
- **非安全**攸关系统。
  
#### 2.3.3 嵌入式软件的组成及特点
下面介绍的嵌入式系统通用架构主要指**目标机环境**架构。

##### 1.嵌入式软件组成架构
嵌入式系统软件组成架构采用**层次化结构**,并具备**可配置**、**可剪裁**的能力。

1. 硬件层。
2. 抽象层。
   - 主要是对硬件层的硬件进行抽象(HAL)，为上层的软件层（操作系统）提供虚拟的硬件资源；（Hardware Abstract Layer）
   - 板级支持包（BSP）是一种硬件驱动软件，面向硬件芯片或电路进行驱动，为操作系统提供对硬件的管理。（Board Support Package）
3. 操作系统层。
   - 操作系统层由嵌入式操作系统、文件系统、图形用户接口、网络系统和通用组件等可配置模块组成。
4. 中间件层。
   - 中间件一般独立于操作系统之上，在嵌入式系统中使用的产品主要是嵌入式数据库、OpenGL图形处理软件、JAVA中间件、虚拟机等。
5. 应用层。
   - 嵌入式系统的具体应用。

##### 2.嵌入式软件的特点
外部环境的变化会对系统硬件性能产生影响，硬件的变化必然会引起软件的反常。

比如，航天领域的辐射会引起存储器的负离子反转，那么存储数据就会发生变化。因此嵌入式软件也要使用恶劣环境的影响。

嵌入式软件的主要特点如下：
1. **可靠**性。
   - 可靠性是在系统**规定**的**条件**下和**时间周期**内能让**程序正常执行**的能力。特别是安全攸关的嵌入式系统。
   - 方法：*容错技术、余度技术和鲁棒性设计。*
2. **安全**性。
   - 安全性是指在**规定**的**条件**和**时间**内**不发生事故**的能力。
   - 方法：*编码标准、安全保障机制、FMECA（故障模式`failure mode`、影响及危害性分析`effects and criticality analysis`）*
3. **高确定**性。
   - 行为是预先设计规划好的，不能因为时间、状态变化而变化。
   - 在系统运行期间，不能发生资源枯竭和未知状态出现，尤其是不能因未知错误引发灾难。
   - 方法：*静态分配资源、越界检查、状态机、静态任务调度等。*
4. 可配置。
   - 根据系统运行状态对软件功能进行拓展、变更。
   - 方法：*数据驱动、静态编译、配置表等*
5. 可剪裁。
   - 根据系统需求，进行适应性功能的加、减。
   - 方法：*静态编译、动态库、控制函数流程等*
  
##### 3. 嵌入式软件开发与传统软件开发的差异

