---
# layout: post
layout: post-custom
title: "系统架构师教程学习笔记"
---

>**万时定律**，10000小时定律。  
简单来说，要成为某个领域顶尖的专业人才，需要10000小时持续不断的练习。例如小提琴、足球、国际象棋、围棋等领域，无一例外都遵循这个定律。  
技术人员的成长需要对技术的热情和持续不断学习，思考，实践和总结。


## 前言
系统架构（System Architecture）是系统的一种整体的高层次的结构表示，是系统的骨架和根级，支撑和链接各个部分。

系统架构设计的主要目的是对需要开发的系统进行一系列的抽象，用于系统各个方面的设计与实现。设计的优劣决定了系统的健壮性和生命周期的长短。

**架构设计**是需求系统开发过程中**需求分析**阶段后的一个关键步骤。架构设计的作用主要包括以下几点：
- 解决相对**复杂的需求**分析问题。
- 解决**非功能**属性在系统占据重要位置的设计问题。
- 解决生命**周期长**、**拓展**性需求**高**的系统整体结构问题。
- 解决系统基于**组件**需要的**集成**问题。
- 解决业务**流程再造**难的问题。


## 发展历程

### 1.基础分析阶段（1968-1994）

随着软件规模的增大，**模块化开发**方法被逐步采用，为后续软件架构的发展奠定了基础。

模块化方法采用对复杂事物分而治之的经典原则。涉及的问题是模块设计的规则，即怎么将系统分解成模块。

每一模块都可独立开发与测试，最后在组装成一个完整软件。

将系统分解为模块，应该遵循以下规则：
1. **高**内聚。  
   - 只实现一种功能的模块是高内聚的，具有三种以上功能的模块则是低内聚的。也就是一个模块内部的元素最大限度的关联，
1. **低**耦合。
   - 不同模块之间的关系尽可能弱，以利于软件的升级和拓展。
2. 模块大小**适度**。
   - 颗粒度大，内部维护困难；
   - 颗粒度小，模块间耦合会增加。
3. 模块**调用链**的嵌套层次不可过多。
4. **接口简单**精炼，具有信息隐蔽能力。
5. 尽可能地**复用**已有模块。

### 2.概念体系的建立和核心技术形成阶段（1999-2000）

2000年，IEEE标准第一次定义了软件架构的形式化标准，这标志着软件架构的理论体系基本建立，具备普及应用的基础。

这一阶段的重要成功之一是：软件**组件化技术**。提升软件**重用**能力和**质量**。

组件的特性：
- 可组装型和可插拔行。
- 组价与组件之间不存在直接耦合关系。
- 组件和组价之间又并非绝对独立，可经过组装后与其他组件进行业务上的交互。

组件化开发与模块化开发区分：
- 组件化开发并不等同于模块化开发。模块化开发只是在逻辑上做了切分，代码通常并没有真正意义上的隔离。

组件化与应用集成区分：
- 组件化也不等同于应用集成，应用集成是将一些基于不同平台或不同方案的应用软件有机集成到一个无缝的、并列的、易于访问的单一系统中，以建立一个统一的综合应用。

组件化比模块化更独立，但比应用集成结合得更加紧密。

### 3.理论体系完善与发展阶段（1996年至今）

在这一阶段，各种方法论都在发展，主要集中在软件架构的如下几个方面：
- 描述与表示；
- 分析、设计和测试；
- 发现、演化和重用；
  - 软件架构发现属于逆向工程，解决如何从已存在的系统中提取软件架构的问题。
  - 软件架构演化是出于需求、技术、环境和分布的变化而导致架构变动。
- 开发方法；
  - 软件开发模型是跨越整个软件生存周期的，从开发、运行和维护所实施的全部工作和任务的结构框架。一般有三种：
    - 瀑布模型。以软件需求完全确认为前提。
    - 渐进式开发模型。如螺旋模型等，在软件开发初期只能提供基本需求为前提。
    - 变换模型。以形式化开发方法为基础。
- 架构风格；
  - 架构风格（架构模式）是针对给定场景中经常出现的问题提供的一般性可重用方案，反映的是领域中众多系统中共有的结构和语义特征，并指导如何将各个子模块和子系统有效地组成一个完整的系统。分类：
    - 数据流风格。
    - 调用/返回风格。
    - 独立组件风格。
    - 虚拟机风格
    - 仓库风格。
- 动态软件架构。

### 4.普及应用阶段（2000年至今）

软件架构是软件生命周期的重要产物，它影响软件开发的各个阶段：
- 需求阶段。
- 设计阶段。
- 实现阶段。
- 维护阶段。


## 软件架构的常用分类及建模方法

### 1.软件架构的常用分类

目前已形成的满足**不同用途**的架构模式，比较典型的有分层架构、事件驱动架构、微核架构、微服务架构和云架构等五类。此外像C/S、B/S、管道-过滤器和PAC等架构也是被广泛使用的。

#### 1.分层架构（LA）

Layered Architecture是最常见、也是事实上的标准架构。层与层之间通过接口进行通信，每一层都有清晰的角色和分工。

最常见的四层结构：
- 表示层（Presentation Layer）。
- 业务层（Business Layer）。
- 持久层（Presistence Layer）。提供数据，SQL语句在这一层。
- 数据层（Database Layer）。保存数据。
  
有的项目在业务层和持久层之间加了一个服务层（Service），提供不同业务逻辑需要的一些通用接口。

#### 2.事件驱动架构（EDA）

Event-Driven Architecture，Event是状态发生变化时软件发出的通知。事件驱动架构是通过事件进行通信的软件架构。它分成四个部分：
- 事件队列（Event Queue）：
  - 接收事件的入口。
- 分发器（Event Mediator）：
  - 将不同的事件分发到不同的业务逻辑单元。
- 事件通道（Event Channel）：
  - 分发器与处理器的联系渠道。
- 事件处理器（Event Processor）：
  - 实现业务逻辑，处理完成后会发出事件，触发下一步操作。

对于简单的项目，事件队列、分发、通道可以合为一体，整个软件就分成**事件代理**和**事件处理**器两部分。

观察者模式常被叫做发布-订阅模式，事件驱动架构是观察者模式的一种最佳实践，常应用于商品系统，物流系统，监控系统，运营数据分析系统等。

#### 3.微核架构

微核架构（Microkernel Architecture）又称为插件架构（Plug-in Architecture），是指软件的内核相对较小，主要功能和业务逻辑都通过插件实现。

内核（Core）通常只包含系统运行的最小功能。插件则是相互独立的，插件之间的通信应该减少到最低，避免出现互相依赖的问题。

#### 4.微服务架构

Microservices Architecture是SOA（Service-Oriented Architecture，服务导向架构）的升级。

每个服务都是一个**独立的部署**单元（Separately Deployed Unit）。这些单元都是**分布式**的，互相解耦，通过远程通信协议（如REST、SOAP）联系。

微服务架构分成三种实现模式：
- RESTful API模式：
  - 服务通过API提供，云服务就属于这一类。
- RESTful 应用模式：
  - 服务通过传统的网络协议或应用协议提供，背后通常是一个多功能的应用程序，常见于企业内部。
- 集中消息模式：
  - 采用消息代理（Message Broker）实现消息队列、负载均衡、统一日志和异常处理，缺点是会出现单点失败，消息代理可能要做成集群。
  


#### 5.云架构

Cloud Architecture主要解决**拓展性**和**并发**的问题。

云架构主要分成两部分：
- 处理单元。
  - 实现业务逻辑。
- 虚拟中间件。
  - 负责通信、保持会话控制、数据复制、分布式处理和部署管理。
  

### 2.软件架构的常用建模方法

1. 结构模型

2. 框架模型

3. 动态模型

4. 过程模型

4种模型并不完全独立，通常需要互相组合来形成一个可以刻画软件架构的完整模型。


## 第2章 计算机系统基础知识


### 2.1 计算机硬件

计算机组成结构源于**冯·诺依曼计算机结构**。

#### 处理器

计算机系统运算和控制核心部件。

位宽：4位 -> 64位。    
内核：单核 -> 多核、异构多核、众核。  
指令集：CISC, RISC。RISC为趋势，化繁为简。  

典型的处理器系统结构：

----指令部件  
---运算部件--寄存器--存储部件  
-----Cache部件--MMU部件  
--完成部件  
-----地址总线  
-----数据总线  

##### 专用处理器
随着时代发展而设计出的专用目的的处理器有：
- **GPU**：图形处理器。
- **DSP**：数字信号处理器。采用**哈佛结构**：
  - 将存储器空间划分成两个，分别存储程序和数据。
  - 它们有两组总线连接到处理器核允许同时对它们进行访问，每个存储器独立编址,独立访问。
- **FPGA**(Field-Programmable Gate Array)：现场可编程逻辑门阵列。是一种由用户进行编程配置的集成电路，主要用途有：
  - 硬件加速：FPGA加速特定计算任务，如图像处理、信号处理、加密算法等。
  - 原型验证：在ASIC（Application-Specific Integrated Circuit，专用集成电路）设计过程中，FPGA常用于验证设计的正确性，因为它可以快速重新配置。
  - 嵌入式系统：FPGA可以集成到嵌入式系统中，实现复杂的控制逻辑和数据处理功能。
  - 通信系统：FPGA在通信系统中广泛应用，用于实现协议处理、信号调制解调等功能。
  - 数据中心：在数据中心中，FPGA可以用于加速特定的计算任务，提高服务器的性能和效率。

#### 存储器

存储器分为：
- 内存储器  
  - ROM（只读存储器）
  - RAM（随机存储器）
    - 1)片上缓存。SRAM结构，处理器直接集成的缓存。16~512KB。
    - 2)片外缓存。SRAM结构。256kb~4MB，可称L2Cache/L3Cache/PlatformCache
    - 3)主存（内存）。DRAM结构，以独立部件/芯片存在，通过总线与处理器链接。容量：数百M~数十GB。
- 外存储器  
  - Flash < 10年
  - 光盘 0 < y < n * 10年
  - 磁盘 > 10年
  - 磁带 > 30年

#### 总线

计算机**部件间**遵循某一特定协议实现**数据交换**的**形式**。

按位置划分为**内总线**，**系统总线**和**外部总线**。

内总线用于芯片内部互联。

系统总线是计算机中CPU、主存、IO接口的总线。

外部总线又称为通信总线，是计算机板和外部设备之间，或计算机系统之间互联的总线。

总线性能指标：
- 总线带宽
- 总线服务质量（QoS，Quality of Service）
- 总线时延
- 总线抖动

#### 接口

计算机**不同层**之间的**通信规则**。

例如有显示接口HDMI/DVI/VGA，音频输入输出接口TRS/RCA/XLR，网络接口 RJ45/FC，USB接口，SATA接口，打印机接口等等。


#### 外部设备

外围设备，如鼠标，键盘，显示器，摄像头或其他移动穿戴设备。


### 2.2 计算机软件

软件是指在系统上运行的**程序**、相关**文档**和**数据**的**集合**。按作用和运行环境分为**系统软件**和**应用软件**两大类。

#### 2.2.1 操作系统

操作系统是计算机系统的**资源管理者**，包含对软、硬件资源实施管理的一组程序。旨在合理**共享和利用**资源，发挥工作**效率**，提升处理**性能**。

##### 1.操作系统的组成

通常由**操作系统内核**和其他许多**附加的配套软件**组成。

操作系统**内核**指的是能提供**进程管理**、**存储管理**、**文件管理**和**设备管理**等功能的软件模块。

##### 2.操作系统的作用

- **管理**计算中运行的程序和分配各种软硬件资源。
- **提供**对用户友善的人机界面
- 为应用程序的开发和运行提供一个高效率的**平台**。
- 其他作用：辅导用户操作，监控系统性能等。

##### 3.操作系统的特征

- 并发性
  - 单核CPU的并发性是指在一段时间内，宏观上多个任务是并发执行的。
  - 多核CPU则可将多个程序分配到不同的CPU执行。
- 不确定性
  - 多个进程并发执行，但具体到何时执行，何时完成的时间并不是确定的，经常可能要等待资源或事件的发生而获得CPU的执行能力。"走走停停"。
- 共享性
  - 同时共享和互斥共享。多用户程序共用一套计算机系统的所有资源。
- 虚拟性
  - 将物理实体变为逻辑上的多个对应物，方便用户使用和操作。

##### 4.操作系统的分类

1. 批处理系统
   - 最早的操作系统之一，通常不具备交互性。通常是将设定好的一批作业交给系统操作员输入计算机后，由系统控制它们自动运行。
   - 典型产品IBM OS/360和OS/390
   
2. 分时操作系统
   - 允许多个用户同时访问计算机资源的操作系统。这话总操作系统将CPU的工作时间划分为许多很短的时间片，轮流分配给每个用户使用。
   - 典型产品：UNIX。
   
3. 实时操作系统
   - 对外来信息以足够快的速度进行处理。对交付能力要求不高，但可靠性要保证。
   - 典型产品：
     - 实时控制系统：数据采集、武器控制、飞机自动驾驶、导弹制导系统等。
     - 信息处理系统：飞机订票系统，情报检索等。

1. 网络操作系统
   - 网络操作系统使联网计算机能方便而有效地**共享网络资源**。
   - 常见的网络操作系统有Windows系列、Linux、Unix
   
2. 分布式操作系统
   - 多个分散的计算机连接而成的计算机系统。是网络操作系统的更高级形式，同时还有透明性、可靠性和高性能等特性。
   
   
3. 微型计算机操作系统
   - 常见的有Windows、MacOS、Linux。

4. 嵌入式操作系统
   - 运行在嵌入式智能设备中。主要特点是：
     - 微型化。
     - 可定制。
     - 实时性。
     - 可靠性。
     - 易移植。
   - 常见的嵌入式实时操作系统有VxWorks，Clinux，PaleOS，WindowsCE等。

  
#### 2.2.2 数据库

数据库是指长期存储在计算机内的，**有组织的**、**统一管理**的相关数据的集合。

目前最常见的是关系型数据库和非关系型数据库。

#### 2.2.3 文件系统
文件系统是指操作系统中实现文件统一管理的一组软件和相关数据的集合。

##### 1.文件的类型

- 用途分：
  - 系统文件、库文件、用户文件
- 保存期限分：
  - 临时文件、档案文件、永久文件
- 保护方式分：
  - 只读、读写、可执行文件
- UNIX系统分：
  - 普通文件、目录文件、设备文件
  
文件系统类型（或叫**磁盘格式**）：
- FAT
  - 文件分配表（File Allocation Table）的缩写。早期的文件系统技术，对文件名命名有诸多约束。
  - 目前基本不再使用。
- VFAT
- NTFS
  - New Technology File System，用在windows系统上，取代了老式的FAT文件系统。
  - NTFS文件系统所具备3个功能：错误预警功能、磁盘自我修复功能和日志功能。
- Ext2
  - Ext系列常用在linux和unix系统上。
- HPFS


```java
public enum FileSystemType {
  FAT,
  VFAT,
  //windows
  NTFS,
  //linux、unix
  Ext2,
  HPFS
  ;
}
```

##### 2.文件的结构和组织
1. 文件的逻辑结构
   - **有结构**的记录式文件。由一个以上的记录构成的文件。
   - **无结构**的流式文件。它是一串顺序字符流构成的文件（字节流）。
2. 文件的物理结构
   - 连续结构
   - 链接结构
   - 索引结构
   - 多个物理块的索引

##### 3.文件存取的方法和存储空间的管理
###### 文件的存取方法
文件的存取方法：
- 顺序读取
- 随机读取

###### 存储空间的管理
文件磁盘空间的管理：
- 空闲区表
- 位示图（BitMap）
- 空闲块链
- 成组链接法
  
##### 4.文件共享和保护
###### 文件共享
使用**文件链接**的方式实现文件共享：
- 硬链接。
  - 也叫基于**索引节点**的链接。硬链接是不同文件名与同一个文件实体的链接，不利于owner删除它拥有的文件（必须先删除所有的硬链接）。
- 符号链接。
  - 建立新的文件和目录，与原来文件或目录的路径名进行映射。
  - 采用符号链接可以跨越文件系统，甚至可以通过计算机网络连接到世界上任何地方的机器中的文件，此时只需提供该文件所在的地址以及在该机器中的文件路径。

###### 文件的保护
文件的保护采用**存取控制**的方式进行。所谓存取控制，就是**规定**不同的用户对文件的访问有**不同的权限**。

- 存取控制矩阵。
- 存取控制表。
- 用户权限表。
- 密码。
  


#### 2.2.4 网络协议
**不同**系统或**终端**之间要实现信息交换或资源分享，需要具备**共同能够理解的语言**，这就是网络协议。

网络协议规定了通信时的数据格式、传送时序、控制信息、应答信号等内容。

常用的网络协议有：
LAN、WAN、WIFI、移动网协议
互联网使用的是TCP/IP协议族。

#### 2.2.5 中间件
承担应用软件在不同系统上可顺利运行的中介，所以叫中间件，它作为应用软件与各种操作系统之间使用的**标准化**编程**接口和协议**。

中间件分类：
- 消息中间件。
  - 如IBMMQ，ActiveMQ，Kafka等。
- 事务处理（交易）中间件。
  - 每项事务在多台应用服务器间协调完成。如Tuxedo。
- 数据存取中间件
  - 经常用于分布式系统中，为虚拟缓冲存取、格式转换、解压等带来方便
- Web服务器中间件
  - 安全中间件
- 跨平台和架构的中间件
- 专用平台中间件
- 网络中间件
  
#### 2.2.6 软件构件
构件/组件：一个**程序集**或一组程序的集合。

构件提供接口供外部来访问，外部不能直接操作构件的内部。

构建的2个重要特性：
- 自包容
- 可重用
  
##### 1.软件构件的组装模型

搭积木式的开发，即构建组装。

通过需求**分析** -> **设计**构建组装结构，明确各构件之间的关系 ->  **建立**构件库 -> **开发**应用构件（独立开发、重用、使用第三方构件等） -> 测试与发布

优点：
- 自包容。
  - 构建之间通过接口访问，相互独立。
- 可重用。
  - 设计良好的构建容易被重用。降低开发成本。
- 颗粒度小。
  - 相对整个系统，构建颗粒度小，开发任务更加灵活，各个构建都可进行独立并行开发。
  
缺点：
- 需要**经验丰富**的架构设计师。
  - 否则结构设计不良，重用性也会降低。
- 性能上会有**让步**。
  - 考虑构建的独立性和重用性，会导致其他方面做出让步，最明显的就是性能。
- 有**学习成本**。
  - 需要程序员熟练掌握构件开发和组装。
- 软件**质量**不好控制。
  - 第三方的构件库质量会最终影响软件质量，而第三方构件库通常很难控制。（木桶原理：木桶容量是根据最短的那块木板决定的）

##### 2.商用构件的标准规范
1. CORBA
2. J2EE
3. DNA

#### 2.2.7 应用软件
应用软件是指为**特定**的应用场景而**设计的软件**。

 应用软件按开发方式和适用范围分为：
 - 通用应用软件
 - 定制应用软件

### 2.3 嵌入式系统及软件
嵌入式系统（Embedded System）是为了**特定应用**而专门构建且将信息处理过程和物理过程紧密结合为一体的**专用**计算机系统。

嵌入式软件是指可运行在嵌入式系统中的**程序代码**和帮助这些软件开发所用的**工具**或**环境**软件的总称。


#### 2.3.1 嵌入式系统的组成及特点
嵌入式系统定义为现代科学**多学科**相互融合的产品：
- **核心**：应用技术；
- **基础**：计算机技术；
- **载体**：通信技术；
- **对象**：消费类产品；
- 引入各类传感器。
- 引入Internet网络技术为连接。
  
嵌入式系统将**可配置**与**可裁剪**集成于一体，并具备相应的**安全性**。需要满足应用对**功能**、**成本**、**体积**、**可靠性**和**功耗**等方面的严格要求。

嵌入式系统是深埋于设备中，对设备的**各种传感器**进行管理和控制的系统。

##### 1.嵌入式系统的组成
1. 嵌入式处理器。
   - 比如ARM处理器
2. 相关支撑硬件。
   - 除处理器外的其他硬件，包括存储器、输入设备、输出设备、IO接口和网络总线。
3. 嵌入式操作系统。
   - 与通用操作系统不同，它具备实时性、可裁剪性和安全性等特征。
4. 支撑软件。
5. 应用软件。
   
###### 总结
1. 硬件：
   - 嵌入式处理器
   - 支撑硬件
2. 软件：
   - 嵌入式操作系统
   - 支撑软件
   - 应用软件
   
##### 2.嵌入式系统的特点
1. **专用**性强。
2. 技术**融合**。
   - 现金的计算机技术、通信技术、半导体技术、电子技术等各行业的具体应用相结合。
3. 软硬**一体**，软件为主。
4. 比通用计算机资源少。
5. **编码**体积**小**，程序代码**固化**在**非易失**存储器中。
   - 软件一般固化在存储器芯片或单片机本身中，而不是存在磁盘中。这是为了提高执行速度和系统可靠性。
   - 非易失存储器如Flash，掉电后不会丢失数据。
6. 开发和运行是在**不同**的**环境**中进行的。（**最大特点**）
   - 需要**专门**的开发**工具**和**环境**。
   - 运行环境为目标机，开发环境为宿主机。
7. 对**安全性**和**可靠性**要求高。
8. 体积小、价格低、工艺先进、性价比高、系统配置要求低、实时性强。（你这是总结？）

#### 2.3.2嵌入式系统的分类
从不同用途分为：
- 嵌入式**实时**系统。
  - 强实时系统。（Hard Real-Time）
  - 若实时系统。（Weak Real-Time）
- 嵌入式**非实时**系统。
  
从安全角度分为：
- **安全**攸关系统。（Safety-Critical / Life-Critical）
- **非安全**攸关系统。
  
#### 2.3.3 嵌入式软件的组成及特点
下面介绍的嵌入式系统通用架构主要指**目标机环境**架构。

##### 1.嵌入式软件组成架构
嵌入式系统软件组成架构采用**层次化结构**,并具备**可配置**、**可剪裁**的能力。

1. 硬件层。
2. 抽象层。
   - 主要是对硬件层的硬件进行抽象(HAL)，为上层的软件层（操作系统）提供虚拟的硬件资源；（Hardware Abstract Layer）
   - 板级支持包（BSP）是一种硬件驱动软件，面向硬件芯片或电路进行驱动，为操作系统提供对硬件的管理。（Board Support Package）
3. 操作系统层。
   - 操作系统层由嵌入式操作系统、文件系统、图形用户接口、网络系统和通用组件等可配置模块组成。
4. 中间件层。
   - 中间件一般独立于操作系统之上，在嵌入式系统中使用的产品主要是嵌入式数据库、OpenGL图形处理软件、JAVA中间件、虚拟机等。
5. 应用层。
   - 嵌入式系统的具体应用。

##### 2.嵌入式软件的特点
外部环境的变化会对系统硬件性能产生影响，硬件的变化必然会引起软件的反常。

比如，航天领域的辐射会引起存储器的负离子反转，那么存储数据就会发生变化。因此嵌入式软件也要使用恶劣环境的影响。

嵌入式软件的主要特点如下：
1. **可靠**性。
   - 可靠性是在系统**规定**的**条件**下和**时间周期**内能让**程序正常执行**的能力。特别是安全攸关的嵌入式系统。
   - 方法：*容错技术、余度技术和鲁棒性设计。*
2. **安全**性。
   - 安全性是指在**规定**的**条件**和**时间**内**不发生事故**的能力。
   - 方法：*编码标准、安全保障机制、FMECA（故障模式`failure mode`、影响及危害性分析`effects and criticality analysis`）*
3. **高确定**性。
   - 行为是预先设计规划好的，不能因为时间、状态变化而变化。
   - 在系统运行期间，不能发生资源枯竭和未知状态出现，尤其是不能因未知错误引发灾难。
   - 方法：*静态分配资源、越界检查、状态机、静态任务调度等。*
4. 可配置。
   - 根据系统运行状态对软件功能进行拓展、变更。
   - 方法：*数据驱动、静态编译、配置表等*
5. 可剪裁。
   - 根据系统需求，进行适应性功能的加、减。
   - 方法：*静态编译、动态库、控制函数流程等*
  
##### 3.嵌入式软件开发与传统软件开发的差异

1. 嵌入式软件开发是在宿主机（PC或工作站）上使用专门的嵌入式工具开发，生成二进制代码后，需要使用工具卸载到目标机或固化在目标机主存器上运行。
2. 嵌入式软件开发更强调软/硬件协同工作的**效率和稳定性**。
3. 嵌入式软件对实时性、安全性和可靠性的要求更高
4. 嵌入式软件需要充分考虑代码规模。
5. 在Life-Critical的嵌入式系统中，其开发还要满足某些领域的设计和代码审定。
6. 嵌入式系统对模块化设计的要求更高，划分好的模块和子系统，有助于实现嵌入式系统的可配置和可剪裁的特点。

#### 2.3.4 安全攸关软件的安全性设计





## 架构风格
软件架构风格是描述某一特定领域中**系统组织方式**的惯用**模式**。

### 主要特征
架构风格定义了一类架构所共有的特征，主要包括：
- 架构定义
- 架构**词汇表**
- 架构**约束**
  
#### 架构定义
...

#### 架构词汇表
词汇表定义了架构中允许使用的组件类型和连接器类型。

#### 架构约束
架构约束定义了组件和连接器之间的合法关系和行为规则。
- 组件约束：
  - 定义组件的行为和属性。例如，组件必须提供特定的接口，组件的状态必须满足某些条件等。
- 连接器约束：
  - 定义连接器的行为和属性。例如，连接器必须支持特定的通信协议，连接器的延迟必须在一定范围内等。
- 配置约束：
  - 定义组件和连接器之间的合法配置。例如，某些类型的组件只能通过特定类型的连接器通信，某些组件不能直接通信等。

#### 举例
1. 分层架构：
   - 词汇表：
     - 组件：`表示层`、`业务层`、`持久层`、`数据层`。
     - 连接器：`接口调用`、`数据库查询`。
   - 约束：
     - 组件约束：每一层只能与其相邻层通信，不能跳过中间层直接通信。
     - 连接器约束：表示层只能通过`接口调用`业务层，业务层只能通过接口调用持久层，持久层只能通过`数据库查询`数据层。
     - 配置约束：`表示层`不能直接访问`数据层`，必须通过`业务层`和`持久层`。

2. 事件驱动架构：
   - 词汇表：
     - 组件：`事件生产者`、`事件处理器`。
     - 连接器：`事件队列`、`事件通道`。
   - 约束：
     - 组件约束：`事件生产者`负责生成事件，`事件处理器`负责处理事件。
     - 连接器约束：`事件队列`负责接收和存储事件，`事件通道`负责分发传输事件到`事件处理器`。
     - 配置约束：`事件生产者`通过`事件队列`、`事件通道`与`事件处理器`通信，不能直接调用。

3. 微服务架构：
   - 词汇表：
     - 组件：独立的`服务`。
     - 连接器：`HTTP/REST`、`消息队列`
   - 约束：
     - 组件约束：每个`服务`必须是独立部署的单元，每个服务负责一个特定的业务功能。
     - 连接器约束：`服务`之间通过`HTTP/REST`或`消息队列`进行通信，通信协议必须标准化。
     - 配置约束：`服务`之间必须松耦合，`服务`的变更不应影响其他服务的正常运行。


### 基于规则的系统
#### 整体流程(7步走)

|步骤|描述|
|---|---|
|1|需求分析|
|2|规则定义|
|3|规则引擎选择|
|4|规则存储与检索|
|5|规则执行|
|6|规则更新与维护|
|7|性能评估与优化|

##### 1.需求分析
在这一步需要明确系统需要实现的功能和规则。例如，一个贷款审批系统需要根据申请人的年龄、收入、信用记录等条件来判断是否批准贷款。
##### 2.规则定义
定义规则是实现基于规则系统的关键。规则通常以 `如果…那么…` 的形式表达。例如：

```
if age > 18 and income > 30000 and credit_score > 700:
  approve_loan()
```

##### 3.规则引擎选择
选择一个合适的规则引擎对于实现基于规则的系统至关重要。常见的规则引擎有Drools、Jess等。

##### 4.规则存储与检索
规则需要存储在某种形式的存储系统中，如数据库或文件系统。以下是一个简单的规则存储示例：

```json
rules = [
  {
    "condition": "age > 18", 
    "action": "approve_loan"
  }
]
```

##### 5.规则执行
在这一步，我们需要编写代码来执行定义好的规则。以下是一个简单的规则执行示例：

```
def execute_rules(person):
  for rule in rules:
    if eval (rule["condition"]):
      eval (rule["action"])
```


##### 6.规则更新与维护
##### 7.规则评估与优化


## 未来信息技术
### 信息物理系统
信息物理系统(Cyber-Physical System, CPS)是嵌入式系统、控制系统的拓展和延伸。

- **定义**：
  - CPS通过先进的**感知**、计算、通信、控制等信息技术和**自动化控制**技术，构建**物理**空间和**信息**空间中人、机、物、环境、信息等**要素**相互**映射**、适时**交互**、高效**协同**的复杂系统。
  - 实现系统内**资源**配置和运行的**按需响应**、快速**迭代**、动态**优化**。
- **本质**：
  - CPS本质是构建一套**物理**空间和**信息**空间之间基于**数据自动流动**的状态**感知**、实时**分析**、科学**决策**、精准**执行**的闭环赋能系统。
  - 解决**生产制造**、**应用服务**过程中的**复杂性**和**不确定性**问题。
  - 提高资源配置效率，实现资源优化。


> 记忆思路：  
> 航天领域，航天器的感知与控制。  
> 汽车制造、道路安全驾驶、雷达监测环境等。

#### 结构

|层次|含义|安全威胁|
|---|---|---|
|感知层|由传感器、控制器、采集器等组成；属于物理信息系统中的末端设备|感知数据破坏、信息窃听、节点捕获|
|网络层|联系物理空间和信息空间的桥梁，实现数据传输，为系统提供实时的网络服务|拒绝性服务攻击、选择性转发、方向误导攻击|
|控制层|根据认知结果和物理设备传回的信息进行数据分析，并将结果返回给客户端|用户信息泄露、恶意代码、非授权访问|

#### 实现



#### 应用场景
